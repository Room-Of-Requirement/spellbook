apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: downloader
  namespace: transmission
spec:
  interval: 1m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: transmission
      version:
      sourceRef:
        kind: HelmRepository
        name: k8s-at-home
        namespace: flux-system
      interval: 1m
  values:
    image:
      repository: ghcr.io/k8s-at-home/transmission
      tag: v3.00
    # To view more enviornment variables see here:
    # https://github.com/k8s-at-home/container-images/tree/main/apps/transmission/settings.json.tmpl
    env:
      TRANSMISSION_INCOMPLETE_DIR_ENABLED: true
      TRANSMISSION_RPC_URL: /downloader/
      TRANSMISSION_RPC_USERNAME: transmission
      TRANSMISSION_RPC_PASSWORD: ${TRANSMISSION_RPC_PASSWORD}
      TRANSMISSION_RPC_AUTHENTICATION_REQUIRED: true
    persistence:
      config:
        enabled: true
        size: 500Mi
        storageClass: ceph-rbd-ssd
        skipuninstall: true
      downloads:
        enabled: true
        size: 200Gi
        storageClass: cephfs
        accessMode: ReadWriteMany
        skipuninstall: true
    ingress:
      enabled: false
    service:
      port:
        port: 80
        targetPort: 9091
