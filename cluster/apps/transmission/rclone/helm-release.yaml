apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: rclone
  namespace: transmission
spec:
  interval: 1m
  chart:
    spec:
      # renovate: registryUrl=https://k8s-at-home.com/charts/
      chart: rclone
      version:
      sourceRef:
        kind: HelmRepository
        name: jmmaloney4
        namespace: flux-system
      interval: 1m
  values:
    config: |
      [s3]
      type = s3
      env_auth = false
      access_key_id = admin
      secret_access_key = ${MINIO_ADMIN_PASSWORD}
      endpoint = http://minio.minio.svc.cluster.local/
    tolerations:
    - key: "RaspberryPi"
      operator: "Exists"
      effect: "NoSchedule"
    volumeMounts:
    - mountPath: /data
      name: data
      readOnly: true
    volumes:
    - name: data
      persistentVolumeClaim:
        claimName: radarr-media
    args:
    - "-vvv"
    - "--no-gzip-encoding"
    - "--check-first"
    - "--size-only"
    - "--low-level-retries"
    - "20"
    - "--use-mmap"
    - "--transfers"
    - "12"
    - "--bwlimit"
    - "5M"
    - "--exclude"
    - "*.part"
    - "/data/"
    - "s3:media"
